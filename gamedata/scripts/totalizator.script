--[[ ---
File : totalizator.script
 Description    : “ÓÚ‡ÎËÁ‡ÚÓ v. 1.1
 Copyright      : 2010 © Erlik(aka Garry_Galler)
Author : Erlik (aka Garry_Galler)
Last edit : 25.09.2010

¡Î‡„Ó‰‡˛ Á‡ ÔÓÏÓ˘¸ ‚ ‡Á‡·ÓÚÍÂ singapur'a22,
--]] -----------------------------------------------------------------------------------------------

function attach(sm)
	sm:subscribe({ signal = "on_update", fun = this.update })
	sm:subscribe({ signal = "on_spawn", fun = this.on_spawn })
	sm:subscribe({ signal = "on_save", fun = this.on_save })
end

local constanta = 60 * 1000 --// ÍÓÌÒÚ‡ÌÚ‡ ‡‚Ì‡ˇ Ó‰ÌÓÈ ÏËÌÛÚÂ Â‡Î¸ÌÓ„Ó ‚ÂÏÂÌË
local last_time_info = 0
local last_time_send = 0
local last_time_dolg = 0
local last_time_deposit = 0
local last_time_news = 0
local dolg = 0
local bank = 0
local deposit = 0
local pause = 2 --// –ø–∞—É–∑–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥–∞ –ø–æ—Å–ª–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞ - –ø–ª—é—Å—É–µ—Ç—Å—è –∫ time_send_prize
local time_send_prize = 720 --// –≤—Ä–µ–º—è –ø—Ä–∏—Ö–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≤—ã–∏–≥—Ä—ã—à–µ\–ø—Ä–æ–∏–≥—Ä—ã—à–µ - –≤ —Å–µ–∫
local time_send_dolg = constanta * 6 --// –ø–æ—Å—ã–ª–∞–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –¥–æ–ª–≥–µ –∫–∞–∂–¥—ã–π –∏–≥—Ä–æ–≤–æ–π —á–∞—Å (–∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º—Å–∫) = 6 —Ä–µ–∞–ª—å–Ω—ã–º –º–∏–Ω—É—Ç–∞–º
local time_index_dolg = constanta * 6 * 12 --//–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º –¥–æ–ª–≥ –∫–∞–∂–¥—ã–µ 12 –∏–≥—Ä–æ–≤—ã—Ö —á–∞—Å–æ–≤ (–∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º—Å–∫)
local time_index_deposit = constanta * 6 * 24 --//–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º –¥–µ–ø–æ–∑–∏—Ç –∫–∞–∂–¥—ã–µ 24 –∏–≥—Ä–æ–≤—ã—Ö —á–∞—Å–æ–≤ (–∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º—Å–∫)
local Timer_Info
local Timer_News
local gameTime_0
local gameTime_1
local gameTime_2
local text_news = ""

function update()
    timer_infoportion()
    timer_deposit()
    timer_dolg()
    timer_send()
    timer_news()
end

local ts = {
sums_1 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500,500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, --\ 14 ÒÛÏÏ ÔÓ 500 
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000,
300000, 300000,
400000,
500000
},

sums_2 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, --\ 14 ÒÛÏÏ ÔÓ 500 
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000,
400000,
500000
},

sums_3 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, --\ 14 ÒÛÏÏ ÔÓ 500 
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000,
400000,
500000
},

sums_4 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, --\ 14 ÒÛÏÏ ÔÓ 500 
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000, 300000,
400000, 400000,
500000
},

sums_5 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, --\ 14 ÒÛÏÏ ÔÓ 500 
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000, 300000,
400000, 400000,
500000
},

sums_6 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500,
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000, 300000,
400000, 400000,
500000
},

sums_7 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500,
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000, 300000,
400000, 400000,
500000
},

sums_8 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500,
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000, 300000,
400000, 400000,
500000
},


sums_9 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500,
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000, 300000,
400000, 400000,
500000
},

--\ ‰Îˇ Ï‡ÍÒËÏ‡Î¸ÌÓÈ ÒÚ‡‚ÍË ÛÏÂÌ¸¯‡ÂÏ ˜ËÒÎÓ ·ÂÁ‚˚Ë„˚¯Ì˚ı ‚‡Ë‡ÌÚÓ‚ Ë ‡ÁÌ˚ı ÏÂÎÍËı ‚˚Ë„˚¯ÂÈ
sums_10 = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500, 500,
1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000,
5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000, 5000,
10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000,
15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000, 15000,
20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000, 20000,
25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000, 25000,
50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,
75000, 75000, 75000, 75000, 75000, 75000, 75000,
100000, 100000, 100000, 100000, 100000,
200000, 200000, 200000, 200000,
300000, 300000, 300000,
400000, 400000,
500000
}
}


local stavka = {1000, 5000, 10000, 15000, 20000, 25000, 30000, 35000, 40000, 50000}

local prize = {0, 500, 1000, 5000, 10000, 15000, 20000, 25000, 50000, 75000, 100000, 200000, 300000, 400000, 500000} --\ —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö —Å—É–º–º

local portion = {
    "frase_1",
    "frase_2",
    "frase_3",
    "frase_4", --\ –∏–Ω—Ñ–æ–ø–æ—Ä—à–Ω–∏ –æ–±—Å—É—Å–ª–∞–≤–ª–∏–≤–∞—é—â–∏–µ —Å—Ç–∞–≤–∫–∏
    "frase_5",
    "frase_6",
    "frase_7",
    "frase_8",
    "frase_9",
    "frase_10"
}

local type_frase = {
    game.translate_string( "type_frase1" ),
    game.translate_string( "type_frase2" ),
    game.translate_string( "type_frase3" ),
    game.translate_string( "type_frase4" ),
    game.translate_string( "type_frase5" ),
    game.translate_string( "type_frase6" )
}

--\ ‰ÂÎ‡ÂÏ ÒÚ‡‚ÍÛ
function transfer_stavka(npc, actor)
    local money = actor:money()
    for n, s in ipairs(stavka) do
        if actor:has_info("frase_"..n) then
            if money > 0 and money < s then --\ —É–º–µ–Ω—å—à–∞–µ–º —Å—Ç–∞–≤–∫—É –¥–æ –Ω–∞–ª–∏—á–∫–∏ —ç–∫—Ç–æ—Ä–∞ - –∑–∞–±–∏—Ä–∞–µ–º –µ–µ - –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–∏—à–µ–º –≤ –¥–æ–ª–≥
                actor:transfer_money(money, npc)--\ –∑–∞–±—Ä–∞—Ç—å –Ω–∞–ª–∏—á–∫—É —ç–∫—Ç–æ—Ä–∞
                talk_message(3,money)
                dolg = dolg +(s-money) --\ –¥–æ–ª–≥ –±—É–¥–µ—Ç —Ä–∞–≤–µ–Ω —Å—Ç–∞–≤–∫–∞ –º–∏–Ω—É—Å —Ç–æ —à–æ –∑–∞–±—Ä–∞–ª–∏ —É —ç–∫—Ç–æ—Ä–∞ -- —Ç–∞–∫–∂–µ –Ω–∞–¥–æ –ø—Ä–∏–ø–ª—é—Å–æ–≤–∞—Ç—å –ø—Ä–µ–∂–Ω–∏–π –¥–æ–ª–≥ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç - –ø–ª—é—Å—É–µ—Ç—Å—è –Ω–æ–ª—å - –≤—Å–µ –Ω–æ—Ä–º
                talk_message(4,s-money)
                talk_message(6,dolg)
            elseif money == 0 then --\ –µ—Å–ª–∏ –º–∞–Ω–∏ –Ω–µ—Ç - –¥–∞–µ–º —ç–∫—Ç–æ—Ä—É —Å—ã–≥—Ä–∞—Ç—å –≤ –¥–æ–ª–≥
                dolg = dolg + s --\ –µ—Å–ª–∏ –¥–æ–ª–≥ —É–∂–µ –µ—Å—Ç—å —Ç–æ –ø–ª—é—Å—É–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –ø–ª—é—Å—É–µ—Ç—Å—è –Ω–æ–ª—å - –≤—Å–µ –Ω–æ—Ä–º
                talk_message(4,s)
                talk_message(6,dolg)
            elseif money == s then --\ –µ—Å–ª–∏ –Ω–∞–ª —Ä–∞–≤–µ–Ω —Å—Ç–∞–≤–∫–µ
                actor:transfer_money(s, npc) --\ –∑–∞–±–∏—Ä–∞–µ–º —Å—Ç–∞–≤–∫—É... –∞ –¥–æ–ª–≥ –∫–∞–∫–æ–π –∑–∞–ø–∏—Å–∞–Ω —Ç–∞–∫–æ–π –∏ –æ—Å—Ç–∞–µ—Ç—Å—è
                talk_message(3,s)
                talk_message(6,dolg)
            elseif money > s then --\ –µ—Å–ª–∏ –Ω–∞–ª–∏—á–∫–∞ —ç–∫—Ç–æ—Ä–∞ –±–æ–ª—å—à–µ —Å—Ç–∞–≤–∫–∏
                actor:transfer_money(s, npc) --\–∑–∞–±–∏—Ä–∞–µ–º —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏...–¥–æ–ª–≥ –æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫–æ–π –±—ã–ª... –µ—Å–ª–∏ –±—ã–ª –≤–æ–æ–±—â–µ...–≤—ã—á–∏—Ç–∞—Ç—å –±—É–¥–µ–º –ø–æ—Å–ª–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
                talk_message(3,s)
                talk_message(6,dolg)
            end
        end
    end
    this.totalizator(actor, npc)
end

--\ —Å—á–∏—Ç–∞–µ–º –≤—ã–∏–≥—Ä—ã—à\–ø—Ä–æ–∏–≥—Ä—ã—à
function totalizator(actor, npc)
    local sums --\ —Å–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é sums –±–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    local summa = 0 --\ —Å–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é summa —Å –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º 0
    for s, v in ipairs(portion) do --\ –∏—Ç–µ—Ä–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ—Ä—à–Ω–µ–π –∏ –µ—Å–ª–∏ –±—ã–ª –≤—ã–¥–∞–Ω –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö (–æ–¥–∏–Ω –∏–∑ 10)
        if actor:has_info(v) then --\ —Ç–æ –µ–≥–æ –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è –∫ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –≤—ã–∏–≥—Ä—ã—à–µ–π (–æ–¥–Ω–æ–π –∏–∑ 10)
            sums = ts["sums_"..s] --\ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∫–ª—é—á –≤ –∫–∞—á–µ—Å—Ç–≤–µ —á–∏—Å–ª–∞ –∫ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –≤—ã–∏–≥—Ä—ã—à–µ–π
            summa = sums[math.random(#sums)] --\ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π summa —Ä–∞–Ω–¥–æ–º–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å—É–º–º—ã –ø–æ –∏–Ω–¥–µ–∫—Å—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∫–æ–ª-–≤–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ —Ç–∞–±–ª–∏—Ü—ã sums_x ( –Ω–æ–º–µ—Ä –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è —Ä–∞–Ω–µ–µ)
        end
    end
    for _, v in ipairs(prize) do
        if summa == v then --\ –∏—â–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ prize —á–∏—Å–ª–æ —Å–æ–≤–ø–¥–∞—é—â–∏–µ —Å –≤—ã–ø–∞–≤—à–µ–π —Å—É–º–º–æ–π - –∏ –µ—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –µ—Å—Ç—å - –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω–¥–µ–∫—Å
            bank = summa --\ –Ω–∞—á–∏—Å–ª—è–µ–º —Å—É–º–º—É –≤ –±–∞–Ω–∫
            break
        end
    end
    disable_portion() --\ –æ—Ç–∫–ª—é—á–∞–µ–º –≤—ã–¥–∞–Ω–Ω—ã–µ –ø–æ—Ä—à–Ω–∏
    if dolg == 0 and bank == 0 then --\ –µ—Å–ª–∏ –≤—ã–∏–≥—Ä—ã—à–∞ –Ω–µ –±—ã–ª–æ –∏ –¥–æ–ª–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ
        text_news = game.translate_string( "type_frase_result1" )
        start_timer_infoportion(time_send_prize+pause)
    elseif dolg == 0 and bank > 0 then --\ –Ω–æ –µ—Å–ª–∏ –≤—ã–∏–≥—Ä—ã—à –±—ã–ª –∏ –¥–æ–ª–≥–æ–≤ —Ç–æ–∂–µ –Ω–µ—Ç —Ç–æ
        text_news = game.translate_string( "type_frase_result2" )..tostring(bank)..game.translate_string( "type_frase_result3" )
        start_timer_infoportion(time_send_prize+pause)
    elseif dolg > 0 and bank == 0 then --\ –µ—Å–ª–∏ –¥–æ–ª–∂–æ–∫ –µ—Å—Ç—å –∏ —Å –≤—ã–∏–≥—Ä—ã—à–µ–º –ø—Ä–æ–ª–µ—Ç —Ç–æ
        text_news = game.translate_string( "type_frase_result4" )..tostring(dolg)..game.translate_string( "type_frase_result5" )
        start_timer_infoportion(time_send_prize+pause)
    elseif dolg > 0 and bank > 0 then --\ –µ—Å–ª–∏ —É —ç–∫—Ç–æ—Ä–∞ –µ—Å—Ç—å –¥–æ–ª–∂–æ–∫ –∏ –±—ã–ª –≤—ã–∏–≥—Ä—ã—à
        if dolg < bank then -- \–∏ –µ—Å–ª–∏ –¥–æ–ª–≥ –º–µ–Ω—å—à–µ –±–∞–Ω–∫–∞ —Ç–æ
            text_news = game.translate_string( "type_frase_result6" )..tostring(bank)..game.translate_string( "type_frase_result7" )..tostring(dolg)..game.translate_string( "type_frase_result8" )..tostring(bank - dolg)..game.translate_string( "type_frase_result3" )
            bank = bank - dolg -- \ –∏—Ç–æ–≥–æ –±–∞–Ω–∫ —Ä–∞–≤–µ–Ω —Å—É–º–º–µ –º–∏–Ω—É—Å –¥–æ–ª–≥ - –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –∏ –æ—Ç–¥–∞–¥–∏–º —ç–∫—Ç–æ—Ä—É –∫–æ–≥–¥–∞ –æ–Ω –ø—Ä–∏–¥–µ—Ç –∑–∞ –≤—ã–∏–≥—Ä—ã—à–µ–º -- —Ç–æ –µ—Å—Ç—å –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–µ –±—É–¥–µ–º –∫–æ–ø–∏—Ç—å –¥–æ–ª–≥–∏, –∞ —Å—Ä–∞–∑—É –∏—Ö –≤—ã—Å—á–∏—Ç–∞–µ–º
            dolg = 0 --\ –¥–æ–ª–≥–æ–≤ –Ω–µ–º–∞
            start_timer_infoportion(time_send_prize+pause)
        elseif dolg == bank then --\ —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ –¥–ª—è —Å–ª—É—á–∞—è –µ—Å–ª–∏ –¥–æ–ª–≥ —Ä–∞–≤–µ–Ω –±–∞–Ω–∫—É. –ó–∞–±–µ—Ä–µ–º –≤—ã–∏–≥—Ä—ã—à, –∞ —ç–∫—Ç–æ—Ä—É –∫—É–∫–∏—à.
            text_news = game.translate_string( "type_frase_result9" )..tostring(bank)..game.translate_string( "type_frase_result10" )
            dolg = 0 --\ –¥–æ–ª–≥–æ–≤ –Ω–µ–º–∞
            bank = 0 --\ –±–∞–Ω–∫ –ø—É—Å—Ç–æ–π
            start_timer_infoportion(time_send_prize+pause)
        elseif dolg > bank then --\ –µ—Å–ª–∏ –¥–æ–ª–≥ –µ—Å—Ç—å –∏ –±—ã–ª –≤—ã–∏–≥—Ä—ã—à, –Ω–æ –¥–æ–ª–≥ –ø–æ–±–æ–ª–µ –≤—ã–∏–≥—Ä—ã—à–∞
            dolg = dolg - bank --\ –≤—ã—á—Ç–µ–º –≤—ã–∏–≥—Ä—ã—à –∏–∑ –¥–æ–ª–≥–∞
            text_news = game.translate_string( "type_frase_result11" )..tostring(bank)..game.translate_string( "type_frase_result12" )..tostring(dolg)..game.translate_string( "type_frase_result13" )   --\ –≤—ã–¥–∞–¥–∏–º —ç–∫—Ç–æ—Ä—É —Å–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –æ–Ω –æ—Å—Ç–∞–ª—Å—è –≤ –¥–æ–ª–≥—É –∏ –µ–º—É –Ω–∏—á–µ –Ω–µ –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è
            start_timer_infoportion(time_send_prize+pause)
            bank = 0 --\ –Ω–∞–¥–æ –ª–∏?
        end
    end
end

--\ –∑–¥–µ—Å—å –≤—ã–¥–∞–µ–º –≤—ã–∏–≥—Ä–∞–Ω–Ω–æ–µ –±–∞–±–ª–æ
function give_prize(actor, npc)
    actor:give_money(bank) --\–≤—ã–¥–∞—Ç—å —ç–∫—Ç–æ—Ä—É —Ç—É —Å—É–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø–∏—Å–∞–ª–∞—Å—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é bank
    talk_message(1,bank)
    bank = 0 --\ —Å—Ä–∞–∑—É –æ–±–Ω—É–ª—è–µ–º –±–∞–Ω–∫
end

--\ –∑–¥–µ—Å—å –æ—Ç–¥–∞–µ–º –¥–æ–ª–≥ - –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∞ –Ω–µ —á–∞—Å—Ç—è–º–∏
function give_dolg(first_speaker, second_speaker)
    db.actor:transfer_money(dolg, second_speaker)
    talk_message(3,dolg)
    dolg = 0 --\ –æ–±–Ω—É–ª—è–µ–º –¥–æ–ª–≥
end

--\ –∑–¥–µ—Å—å –æ—Ç–¥–∞–µ–º –¥–µ–Ω—å–≥–∏ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
function transfer_bank()
    if deposit == 0 then --\ –µ—Å–ª–∏ –¥–µ–ø–æ–∑–∏—Ç –ø–æ–∫–∞ –ø—É—Å—Ç –∏ –≤ –±–∞–Ω–∫–µ —á–µ –µ—Å—Ç—å —Ç–æ
        deposit = bank --\ —Å–¥–µ–ª–∞–µ–º —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –≤ –¥—Ä—É–≥—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
        news_manager.send_tip(db.actor, game.translate_string( "transfer_bank1" )..tostring(deposit), 5, "default", 10000)
        talk_message(2,deposit)
        talk_message(5,deposit)
        bank = 0
    elseif deposit > 0 then
        deposit = deposit + bank
        news_manager.send_tip(db.actor, game.translate_string( "transfer_bank1" )..tostring(bank)..game.translate_string( "transfer_bank2" )..tostring(deposit), 5, "default", 10000)
        talk_message(2,bank)
        talk_message(5,deposit)
        bank = 0
    end
end

--\–∑–¥–µ—Å—å –∑–∞–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –Ω–µ–ø–æ—Å–∏–ª—å–Ω—ã–º —Ç—Ä—É–¥–æ–º... "—Ç—Ä–∏ –ø–æ—Ä—Ç—Å–∏–≥–∞—Ä–∞, –¥–≤–µ –∫—É—Ä—Ç–∫–∏ –∑–∞–º—à–µ–≤—ã—Ö..."
function transfer_deposit(npc, actor)
    local summa = 0
    local t = {"dep_1","dep_2","dep_3"}
    if actor:has_info("dep_1") then
        summa = math.ceil(deposit/10)
        actor:give_money(summa)
        news_manager.send_tip(db.actor, game.translate_string( "transfer_deposit1" )..tostring(summa)..game.translate_string( "transfer_deposit2" )..tostring(deposit - summa), 5, "default", 10000)
        deposit = deposit - summa
        talk_message(1,summa)
        talk_message(5,deposit)
        summa = 0
    elseif actor:has_info("dep_2") then
        summa = math.ceil(deposit/2)
        actor:give_money(summa)
        news_manager.send_tip(db.actor, game.translate_string( "transfer_deposit1" )..tostring(summa)..game.translate_string( "transfer_deposit2" )..tostring(deposit - summa), 5, "default", 10000)
        deposit = deposit - summa
        talk_message(1,summa)
        talk_message(5,deposit)
        summa = 0
    elseif actor:has_info("dep_3") then
        actor:give_money(deposit)
	    news_manager.send_tip(db.actor, game.translate_string( "transfer_deposit1" )..tostring(deposit)..game.translate_string( "transfer_deposit3" ), 5, "default", 10000)
        talk_message(1,deposit)
        deposit = 0
        talk_message(5,deposit)
    end
    for _,v in ipairs(t) do
        if db.actor:has_info(v) then
            db.actor:disable_info_portion(v)
        end
    end
end

function timer_news()
    if text_news and text_news~="" then --\–Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–æ–≤–æ—Å—Ç—å
        if Timer_News==nil then
            if last_time_news ~= 0 then --\ –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–ª –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å - –ø–µ—Ä–µ–≤–∑–≤–æ–¥–∏–º –Ω–∞ –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
                Timer_News = time_global() + last_time_news --/ –≤–∑–≤–æ–¥–∏–º —Ç–∞–π–º–µ—Ä –Ω–∞ –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
            else --\ –∏–Ω–∞—á–µ -–≤–∑–≤–æ–¥–∏–º –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –≤—Ä–µ–º—è
                Timer_News = time_global() + 1000 * time_send_prize
            end
        end
        last_time_news = Timer_News - time_global() -- –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∫–æ–Ω—Ü–∞ —Ä–∞–±–æ—Ç—ã —Ç–∞–π–º–µ—Ä–∞
        if Timer_News < time_global() then --/ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            Timer_News = nil --/ –≤—ã–∫–ª—é—á–∞–µ–º —Ç–∞–π–º–µ—Ä
            last_time_news = 0
            set_message() --\ –≤—ã–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        end
    end
end

--\ —Ç–∞–π–º–µ—Ä –¥–ª—è –≤—ã–∫–ª—é—á–µ–Ω–∏—è –∏–Ω—Ñ–ø–æ—Ä—à–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥–∞ —Å–æ —Å—Ç–∞–≤–∫–∞–º–∏
function start_timer_infoportion(seconds) --/ (–ø–µ—Ä–µ)–∑–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ (–∏–∑ –¥–∏–∞–ª–æ–≥–∞)
    Timer_Info = time_global() + seconds * 1000 --/ –≤–∑–≤–æ–¥–∏–º —Ç–∞–π–º–µ—Ä –Ω–∞ –º–∏–Ω
end

--\ —Ç–∞–π–º–µ—Ä –¥–ª—è –≤—ã–∫–ª—é—á–µ–Ω–∏—è –∏–Ω—Ñ–ø–æ—Ä—à–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥–∞ —Å–æ —Å—Ç–∞–≤–∫–∞–º–∏
function timer_infoportion()
    if not Timer_Info then
        if last_time_info ~= 0 then --\ –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–ª –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å - –ø–µ—Ä–µ–≤–∑–≤–æ–¥–∏–º –Ω–∞ –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
            Timer_Info = time_global() + last_time_info --/ –≤–∑–≤–æ–¥–∏–º —Ç–∞–π–º–µ—Ä –Ω–∞ –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
        end
    else
        last_time_info = Timer_Info-time_global() -- –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∫–æ–Ω—Ü–∞ —Ä–∞–±–æ—Ç—ã —Ç–∞–π–º–µ—Ä–∞
        if Timer_Info < time_global() then --/ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            enable_dialog()
            Timer_Info = nil --/ –≤—ã–∫–ª—é—á–∞–µ–º —Ç–∞–π–º–µ—Ä
            last_time_info = 0
        end
    end
end

--\ —Ç–∞–π–º–µ—Ä –¥–ª—è –≤—ã–¥–∞—á–∏ –≥–Ω–µ–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ –¥–æ–ª–≥–µ
function timer_send()
    if dolg ~= 0 then
        if not gameTime_0 then --\ –ø–µ—Ä–µ–≤–∑–≤–æ–¥–∏–º
            if last_time_send ~= 0 then
                gameTime_0 = time_global() + last_time_send
            else
                gameTime_0 = time_global() + time_send_dolg
            end
        end
        last_time_send= gameTime_0 - time_global() --\ —Å—á–∏—Ç–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
        if gameTime_0 < time_global() then
            send()
            gameTime_0 = nil --\\ –æ–±–Ω–∏–ª–∏–≤–∞–µ–º
            last_time_send = 0
        end
    else --\\ –µ—Å–ª–∏ –¥–æ–ª–≥–∞ —É–∂–µ –Ω–µ—Ç - –æ–±–Ω–∏–ª–∏–≤–∞–µ–º
        gameTime_0 = nil
        last_time_send = 0
    end
end

--\ —Ç–∞–π–º–µ—Ä –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å—É–º–º—ã –¥–æ–ª–≥–∞
function timer_dolg()
    if dolg ~= 0 then
        if not gameTime_1 then --\ –ø–µ—Ä–µ–≤–∑–≤–æ–¥–∏–º
            if last_time_dolg ~= 0 then
                gameTime_1 = time_global() + last_time_dolg
            else
                gameTime_1 = time_global() + time_index_dolg
            end
        end
        last_time_dolg = gameTime_1 - time_global() --\ —Å—á–∏—Ç–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
        if gameTime_1 < time_global() then
            percent_dolg()
            gameTime_1 = nil --\\ –æ–±–Ω–∏–ª–∏–≤–∞–µ–º
            last_time_dolg = 0
        end
    else --\\ –µ—Å–ª–∏ –¥–æ–ª–≥–∞ —É–∂–µ –Ω–µ—Ç - –æ–±–Ω–∏–ª–∏–≤–∞–µ–º
        gameTime_1 = nil
        last_time_dolg = 0
    end
end

--\ —Ç–∞–π–º–µ—Ä –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å—É–º–º—ã –¥–µ–ø–æ–∑–∏—Ç–∞
function timer_deposit()
    if deposit ~= 0 then
        if not gameTime_2 then --\ –ø–µ—Ä–µ–≤–∑–≤–æ–¥–∏–º
            if last_time_deposit ~= 0 then
                gameTime_2 = time_global() + last_time_deposit
            else
                gameTime_2 = time_global() + time_index_deposit
            end
        end
        last_time_deposit = gameTime_2 - time_global() --\ —Å—á–∏—Ç–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
        if gameTime_2 < time_global() then
            percent_deposit()
            gameTime_2 = nil
            last_time_deposit = 0
        end
    else --\\ –µ—Å–ª–∏ –¥–µ–ø–æ–∑–∏—Ç –ª–∏–∫–∏–≤–¥–∏—Ä–æ–≤–∞–Ω - –æ–±–Ω–∏–ª–∏–≤–∞–µ–º
        gameTime_2 = nil
        last_time_deposit = 0
    end
end

--**
--–ò–ù–î–ï–ö–°–ê–¶–ò–Ø –°–£–ú–ú –ò –û–¢–°–´–õ–ö–ê –°–û–û–ë–©–ï–ù–ò–ô
--**
--\ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ - –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç–∞–π–º–µ—Ä–æ–º —á–µ—Ä–µ–∑ –∫–∞–∂–¥—ã–π –∏–≥—Ä–æ–≤–æ–π –¥–µ–Ω—å
function percent_deposit()
    if deposit == 0 then
        return
    elseif deposit > 0 and deposit < 50000 then
        deposit = math.ceil(deposit + deposit/100*math.random(5,8))
        news_manager.send_tip(db.actor, "–°—Ç–∞–ª–∫–µ—Ä, —Å—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞ –≤—ã—Ä–æ—Å–ª–∞ –¥–æ "..tostring(deposit).." —Ä.", 5, "default", 10000) 
    elseif deposit > 50000 and deposit < 100000 then
        deposit = math.ceil(deposit + deposit/100*math.random(9,12))
        news_manager.send_tip(db.actor, "–°—Ç–∞–ª–∫–µ—Ä, —Å—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞ –≤—ã—Ä–æ—Å–ª–∞ –¥–æ "..tostring(deposit).." —Ä.", 5, "default", 10000) 
    elseif deposit > 100000 and deposit < 300000 then
        deposit = math.ceil(deposit + deposit/100*math.random(13,15))
        news_manager.send_tip(db.actor, "–°—Ç–∞–ª–∫–µ—Ä, —Å—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞ –≤—ã—Ä–æ—Å–ª–∞ –¥–æ "..tostring(deposit).." —Ä.", 5, "default", 10000) 
    elseif deposit > 300000 then
        deposit = math.ceil(deposit + deposit/100*math.random(16,20))
        news_manager.send_tip(db.actor, "–°—Ç–∞–ª–∫–µ—Ä, —Å—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞ –≤—ã—Ä–æ—Å–ª–∞ –¥–æ "..tostring(deposit).." —Ä.", 5, "default", 10000) 
    end
end


--==
--\ —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–æ–ª–≥–∞ - –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç–∞–π–º–µ—Ä–æ–º —á–µ—Ä–µ–∑ 12 –∏–≥—Ä–æ–≤—ã—Ö —á–∞—Å–æ–≤
function percent_dolg()
    if dolg == 0 then
        return
    elseif dolg > 0 and dolg < 50000 then
        dolg = math.ceil(dolg + dolg/100*10) 
        news_manager.send_tip(db.actor, "–°—Ç–∞–ª–∫–µ—Ä, —Ç–≤–æ–π –¥–æ–ª–≥ –≤—ã—Ä–æ—Å –¥–æ "..tostring(dolg).." —Ä.", 5, "default", 10000) 
    elseif dolg > 50000 and dolg < 100000 then
        dolg = math.ceil(dolg + dolg/100*30)
        news_manager.send_tip(db.actor, "–°—Ç–∞–ª–∫–µ—Ä, —Ç–≤–æ–π –¥–æ–ª–≥ –≤—ã—Ä–æ—Å –¥–æ "..tostring(dolg).." —Ä.", 5, "default", 10000) 
    elseif dolg > 100000 and dolg < 300000 then
        dolg = math.ceil(dolg + dolg/100*50)
        news_manager.send_tip(db.actor, "–°—Ç–∞–ª–∫–µ—Ä, —Ç–≤–æ–π –¥–æ–ª–≥ –≤—ã—Ä–æ—Å –¥–æ "..tostring(dolg).." —Ä.", 5, "default", 10000) 
    elseif dolg > 300000 then
        dolg = math.ceil(dolg + dolg/100*70)
        news_manager.send_tip(db.actor, "–°—Ç–∞–ª–∫–µ—Ä, —Ç–≤–æ–π –¥–æ–ª–≥ –≤—ã—Ä–æ—Å –¥–æ "..tostring(dolg).." —Ä.", 5, "default", 10000) 
    end
end

--==
--\ –∑–¥–µ—Å—å –Ω–∞—á–∏–Ω–∞–µ–º —É–≥—Ä–æ–∂–∞—Ç—å —ç–∫—Ç–æ—Ä—É –ø–æ—Å—ã–ª–∞—è –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è –æ –¥–æ–ª–≥–µ
function send()
    if dolg == 0 then
        return
    elseif dolg > 5000 and dolg < 30000 then
        news_manager.send_tip(db.actor, "dolg_1", 0, "killer", 5000)
    elseif dolg > 30000 and dolg < 50000 then
        news_manager.send_tip(db.actor, "dolg_2", 0, "killer", 5000)
    elseif dolg > 50000 and dolg < 80000 then
        news_manager.send_tip(db.actor, "dolg_3", 0, "killer", 5000)
    elseif dolg > 80000 and dolg < 110000 then
        news_manager.send_tip(db.actor, "dolg_4", 0, "killer", 5000)
    elseif dolg > 110000 and dolg < 150000 then
        news_manager.send_tip(db.actor, "dolg_5", 0, "killer", 5000)
    elseif dolg > 150000 and dolg < 200000 then
        news_manager.send_tip(db.actor, "dolg_6", 0, "killer", 5000)
    elseif dolg > 200000 and dolg < 300000 then
        news_manager.send_tip(db.actor, "dolg_7", 0, "killer", 5000)
    elseif dolg > 300000 and dolg < 400000 then
        news_manager.send_tip(db.actor, "dolg_8", 0, "killer", 5000)
    elseif dolg > 400000 and dolg < 500000 then
        news_manager.send_tip(db.actor, "dolg_9", 0, "killer", 5000)
    elseif dolg > 500000 then
        news_manager.send_tip(db.actor, "dolg_10", 0, "killer", 5000)
    end
end

-- –ø—Ä–µ–∫–æ–Ω–¥–∏—à–µ–Ω –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–∏–≥—Ä—ã—à–∞
function precond()
    return bank > 0
end

-- –ø—Ä–µ–∫–æ–Ω–¥–∏—à–µ–Ω –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å–æ —Å—Ç–∞–≤–∫–∞–º–∏
function precond_2()
    return bank == 0
end

--\ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ –æ—Ç–¥–∞—á–∏ –¥–æ–ª–≥–∞
function precond_3()
    local money = db.actor:money()
    return dolg > 0 and money >= dolg and bank == 0
end

--\ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å–Ω—è—Ç–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞
function precond_4()
    return deposit > 0
end

--\ –¥–ª—è —Ñ—Ä–∞–∑—ã –æ—Ç–∫–∞–∑–∞
function precond_5()
    return dolg > 100000
end

--\ –¥–ª—è —Ñ—Ä–∞–∑—ã
function precond_6()
    return dolg < 100000
end

--\ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ñ—Ä–∞–∑ –ì–ì - —Ñ—Ä–∞–∑—ã —Å–æ —Å—Ç–∞–≤–∫–∞–º–∏
function random_dialog()
    local i = math.random(10)
    db.actor:give_info_portion("frase_"..tostring(i))
end

--\—Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–∫–æ–Ω–∫–æ–π –≤ –æ–∫–Ω–æ –¥–∏–∞–ª–æ–≥–∞
function talk_message(id,num)
    local task_texture, task_rect
    if id == 3 or id == 4 or id==6 then
        task_texture, task_rect = get_texture_info("ui_iconsTotal_lost_money")
    else
        task_texture, task_rect = get_texture_info("ui_iconsTotal_found_money")
    end
    db.actor:give_talk_message(type_frase[id].." "..tostring(num).." rur.", task_texture, task_rect, "actor_iconed_answer_item")
end

--\ –¥–µ–ª–∞–µ–º –¥–∏–∞–ª–æ–≥ —Å–æ —Å—Ç–∞–≤–∫–∞–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º
function enable_dialog()
    if has_alife_info("totalizator") then
        db.actor:disable_info_portion("totalizator")
    end
end

--\ –≤—ã–∫–ª—é—á–∞–µ–º –≤—Å–µ –≤—ã–¥–∞–Ω–Ω—ã–µ –∏–Ω—Ñ–æ–ø–æ—Ä—à–Ω–∏
function disable_portion()
    for k, v in pairs(portion) do
        if db.actor:has_info(v) then
            db.actor:disable_info_portion(v)
        end
    end
end

function set_message()
    if text_news and text_news~="" then
        news_manager.send_tip(db.actor, text_news, 0 , "default", 15000)
        text_news= ""
    end
end

function SendMessage(text)
    news_manager.send_tip(db.actor, text, 0, "default", 10000)
end

--// ÒÓı‡ÌÂÌËÂ Ë Á‡„ÛÁÍ‡ Ú‡·ÎË˜Ì˚ı Ë ÔÓ˜Ëı ‰‡ÌÌ˚ı - Ú‡Í Í‡Í ÙÓÌ‡ËÍ ‚ÒÂ„‰‡ ‚ ÓÌÎ‡ÈÌÂ  - Ó˜ÂÌ¸ Û‰Ó·ÌÓ ËÒÔÓÎ¸ÁÓ‚‡Ú¸
function on_save()
  ogse.save_var("totalizator.dolg", dolg, "u32")
  ogse.save_var("totalizator.bank", bank, "u32")
  ogse.save_var("totalizator.deposit", deposit, "u32")
  ogse.save_var("totalizator.last_time_dolg", last_time_dolg, "u32")
  ogse.save_var("totalizator.last_time_deposit", last_time_deposit, "u32")
  ogse.save_var("totalizator.last_time_send", last_time_send, "u32")
  ogse.save_var("totalizator.last_time_info", last_time_info, "u32")
  ogse.save_var("totalizator.last_time_news", last_time_news, "u32")
  ogse.save_var("totalizator.text_news", text_news, "string")
end

function on_spawn()
  dolg = ogse.load_var("totalizator.dolg", 0)
  bank = ogse.load_var("totalizator.bank", 0)
  deposit = ogse.load_var("totalizator.deposit", 0)
  last_time_dolg = ogse.load_var("totalizator.last_time_dolg", 0)
  last_time_deposit = ogse.load_var("totalizator.last_time_deposit", 0)
  last_time_send = ogse.load_var("totalizator.last_time_send", 0)
  last_time_info = ogse.load_var("totalizator.last_time_info", 0)
  last_time_news = ogse.load_var("totalizator.last_time_news", 0)
  text_news = ogse.load_var("totalizator.text_news", "")
end